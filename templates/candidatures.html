<!-- jobs/templates/candidatures.html -->

{% extends 'base.html' %}
{% include './partials/_menu.html' %}

{% block main %}
<script>
    function toggleExpired(jobId) {
        fetch('/toggle_expired/' + jobId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        }).then(() => {
            location.reload();
        });
    }
</script>
<main class="container-fluid">
    {% if user.is_admin %}
    {% include './partials/_form.html' %}
    {% endif %}
    {% if jobs %}
    <!-- Desktop table -->
    <div class="d-none d-lg-block">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                {% if user.is_admin %}<th>Update</th>{% endif %}
                <th>Offre</th><th>Capture</th><th>Location</th><th>Company</th><th>Contact</th><th>E-Mail</th><th>Date candidature</th><th>Date relance</th><th>Date refus</th><th>Expirée</th>
            </tr>
            </thead>
            <tbody>
            {% for job in jobs %}
            <tr class="{% if not job.active %}table-secondary{% endif %}">
                {% if user.is_admin %}<td><a href="{{ url_for('update', id=job.id) }}" class="btn btn-sm btn-primary" title="Modifier #{{job.id}}">✏️</a></td>{% endif %}
                <td><a href="{{ job.url }}" target="_blank">{{ job.name }}</a></td>
                <td>{% if job.is_capture %}{% set capture = 'images/' + ('capture_%s.pdf' % job.id) %}<a href="{{ url_for('static', filename=capture) }}" target="_blank" class="btn btn-sm btn-outline-success">PDF</a>{% else %}<span class="text-muted">⌐</span>{% endif %}</td>
                <td>{{ job.zipCode }}</td><td>{{ job.company }}</td><td>{{ job.contact }}</td>
                <td class="{% if not job.email %}bg-warning{% endif %}">{{ job.email }}</td>
                <td class="{% if job.expired %}bg-danger text-white{% endif %}">{{job.applicationDate.strftime('%d/%m/%Y')}}</td>
                <td>{% if job.relaunchDate %}{{job.relaunchDate.strftime('%d/%m/%Y')}}{% endif %}</td>
                <td>{% if job.refusalDate %}{{job.refusalDate.strftime('%d/%m/%Y')}}{% endif %}</td>
                <td><input type="checkbox" class="form-check-input" onchange="toggleExpired({{ job.id }})" {% if not job.active %}checked{% endif %}></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Mobile cards -->
    <div class="d-lg-none">
        {% for job in jobs %}
        <div class="card mb-2 {% if not job.active %}bg-light{% endif %}">
            <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-start mb-1">
                    <h6 class="card-title mb-0 small"><a href="{{ job.url }}" target="_blank">{{ job.name }}</a></h6>
                    {% if user.is_admin %}<a href="{{ url_for('update', id=job.id) }}" class="btn btn-sm btn-primary" title="Modifier #{{job.id}}">✏️</a>{% endif %}
                </div>
                <div class="small text-muted mb-1"><strong>{{ job.company }}</strong> - {{ job.zipCode }}</div>
                <div class="small mb-1">{{ job.contact }} {% if job.email %}- {{ job.email }}{% endif %}</div>
                <div class="d-flex justify-content-between align-items-center small">
                    <span class="{% if job.expired %}bg-danger text-white px-1 rounded{% endif %}">{{job.applicationDate.strftime('%d/%m')}}</span>
                    <div>
                        {% if job.is_capture %}{% set capture = 'images/' + ('capture_%s.pdf' % job.id) %}<a href="{{ url_for('static', filename=capture) }}" target="_blank" class="btn btn-sm btn-outline-success py-0">PDF</a>{% endif %}
                        <input type="checkbox" class="form-check-input ms-2" onchange="toggleExpired({{ job.id }})" {% if not job.active %}checked{% endif %} title="Expirée">
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center mt-5"><p class="fs-5">Pas de candidature en cours ✌️</p></div>
    {% endif %}
</main>
{% endblock main %}
